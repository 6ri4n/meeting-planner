const selectedDays={};function handleCalendar(){let e={1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"},t=document.querySelector(".day"),n=document.querySelector(".calendar header span"),a=new Date,r=a.getFullYear(),l=a.getMonth()+1;function o(){let a=new Date(r,l-1,0),o=new Date(r,l,0).getDate(),s=new Date(a);s.setDate(s.getDate()-a.getDay()),lastSundayPrevMonth=s.getDate(),a=a.getDate(),n.textContent=e[l]+" "+r;for(let c=lastSundayPrevMonth;c<=a;c++){let d=document.createElement("li");d.classList.add("not-current-month"),d.textContent=c,t.appendChild(d)}for(let i=1;i<=o;i++){let{formatKey:u,formatValue:y}=f(l,i,r),m=document.createElement("li");m.classList.add("current-month"),m.textContent=i,m.id=u,selectedDays.hasOwnProperty(u)&&m.classList.add("selected-day"),m.addEventListener("click",e=>{if(e.target.classList.toggle("selected-day")){if(14===Object.keys(selectedDays).length)return e.target.classList.remove("selected-day"),alert("You can only select up to 14 days.");selectedDays[u]=y}else delete selectedDays[u]}),t.appendChild(m)}for(let h=1;h<42-o-(a-lastSundayPrevMonth);h++){let g=document.createElement("li");g.classList.add("not-current-month"),g.textContent=h,t.appendChild(g)}function f(t,n,a){let r=new Date(a,t-1,n),l=e[t],o=r.toLocaleDateString("en-US",{weekday:"long"});return{formatKey:`${t}-${n}-${a}`,formatValue:{month:t,day:n,dayLong:o,monthLong:l,year:a}}}}document.querySelectorAll(".calendar-nav button").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),"prev"===e.target.id?(1===l?(l=12,r-=1):l-=1,a=new Date(r,l-1)):(12===l?(l=1,r+=1):l+=1,a=new Date(r,l-1)),t.replaceChildren(),o()})}),o()}function handleFormSubmit(){document.querySelector("form").addEventListener("submit",async e=>(e.preventDefault(),0===Object.entries(selectedDays).length)?alert("Meeting days cannot be empty."):e.srcElement[0].value.length>=61?alert("Meeting name cannot be over 60 characters."):e.srcElement[1].value.length>=256?alert("Meeting description cannot be over 255 characters."):void handleRequest(e)),document.querySelector("#cancel").addEventListener("click",e=>{e.preventDefault(),window.location.reload()})}async function handleRequest(e){let t=new FormData(e.target),n=sortDates(),a={};t.forEach((e,t)=>{a[t]=e}),a.selectedDays=n;try{let r=await fetch("/api/event/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok)throw Error(`HTTP error! Status: ${r.status}`);let l=await r.json();l.redirect_url&&(window.location.href=l.redirect_url)}catch(o){console.error(o)}}function sortDates(){let e=Object.entries(selectedDays);return e.sort((e,t)=>{let n=e[1],a=t[1];return n.year!==a.year?n.year-a.year:n.month!==a.month?n.month-a.month:n.day-a.day}),Object.fromEntries(e)}function loadTimezone(){let e=Intl.DateTimeFormat().resolvedOptions().timeZone,t=document.getElementById("timezone");for(let n=0;n<t.options.length;n++)if(t.options[n].value===e){t.selectedIndex=n;break}}window.onload=function(){loadTimezone(),handleCalendar(),handleFormSubmit(),document.getElementById("eventName").value="",document.getElementById("description").value="",document.getElementById("startTimeSelector").selectedIndex=0,document.getElementById("endTimeSelector").selectedIndex=0};